/* Define to prevent recursive inclusion -------------------------------------*/
#ifndef _READTEMP_C
#define _READTEMP_C

#include "Adc.h"
#include "Readtemp.h"
#include "Process.h"

const unsigned short temp_AD[801]=
{
  0,39,79,119,158,198,238,277,317,357,
  397,437,477,517,557,597,637,677,718,758,
  798,838,879,919,960,1000,1041,1081,1122,1163,
  1203,1244,1285,1326,1366,1407,1448,1489,1530,1571,
  1612,1653,1694,1735,1776,1817,1858,1899,1941,1982,
  2023,2064,2106,2147,2188,2230,2271,2312,2354,2395,
  2436,2478,2519,2561,2602,2644,2685,2727,2768,2810,
  2851,2893,2934,2976,3017,3059,3100,3142,3184,3225,
  3267,3308,3350,3391,3433,3474,3516,3557,3599,3640,
  3682,3723,3765,3806,3848,3889,3931,3972,4013,4055,
  4096,4138,4179,4220,4262,4303,4344,4385,4427,4468,
  4509,4550,4591,4633,4674,4715,4756,4797,4838,4879,
  4920,4961,5002,5043,5084,5124,5165,5206,5247,5288,
  5328,5369,5410,5450,5491,5532,5572,5613,5653,5694,
  5735,5775,5815,5856,5896,5937,5977,6017,6058,6098,
  6138,6179,6219,6259,6299,6339,6380,6420,6460,6500,
  6540,6580,6620,6660,6701,6741,6781,6821,6861,6901,
  6941,6981,7021,7060,7100,7140,7180,7220,7260,7300,
  7340,7380,7420,7460,7500,7540,7579,7619,7659,7699,
  7739,7779,7819,7859,7899,7939,7979,8019,8059,8099,
  8138,8178,8218,8258,8298,8338,8378,8418,8458,8499,
  8539,8579,8619,8659,8699,8739,8779,8819,8860,8900,
  8940,8980,9020,9061,9101,9141,9181,9222,9262,9302,
  9343,9383,9423,9464,9504,9545,9585,9626,9666,9707,
  9747,9768,9828,9869,9909,9950,9991,10031,10072,10113,
  10153,10194,10235,10276,10316,10357,10398,10439,10480,10520,
  10561,10602,10643,10684,10725,10766,10807,10848,10889,10930,
  10971,11012,11053,11094,11135,11176,11217,11259,11300,11341,
  11382,11423,11465,11506,11547,11588,11630,11671,11712,11753,
  11795,11836,11877,11919,11960,12001,12043,12084,12126,12167,
  12209,12250,12291,12333,12374,12416,12457,12499,12540,12582,
  12624,12665,12707,12748,12790,12831,12873,12915,12956,12998,
  13040,13081,13123,13165,13206,13248,13290,13331,13373,13415,
  13457,13498,13540,13582,13624,13665,13707,13749,13791,13833,
  13874,13916,13958,14000,14042,14084,14126,14167,14209,14251,
  14293,14335,14377,14419,14461,14503,14545,14587,14629,14671,
  14713,14755,14797,14839,14881,14923,14965,15007,15049,15091,
  15133,15175,15217,15259,15301,15343,15385,15427,15469,15511,
  15554,15596,15638,15680,15722,15764,15806,15849,15891,15933,
  15975,16017,16059,16102,16144,16186,16228,16270,16313,16355,
  16397,16439,16482,16524,16566,16608,16651,16693,16735,16778,
  16820,16862,16904,16947,16989,17031,17074,17116,17158,17201,
  17243,17285,17328,17370,17413,17455,17497,17540,17582,17624,
  17667,17709,17752,17794,17837,17879,17921,17964,18006,18049,
  18091,18134,18176,18218,18261,18303,18346,18388,18431,18473,
  18516,18558,18601,18643,18686,18728,18771,18813,18856,18898,
  18941,18983,19026,19068,19111,19154,19196,19239,19281,19324,
  19366,19409,19451,19494,19537,19579,19622,19664,19707,19750,
  19792,19835,19877,19920,19962,20005,20048,20090,20133,20175,
  20218,20261,20303,20346,20389,20431,20474,20516,20559,20602,
  20644,20687,20730,20772,20815,20857,20900,20943,20985,21028,
  21071,21113,21156,21199,21241,21284,21326,21369,21412,21454,
  21497,21540,21582,21625,21668,21710,21753,21796,21838,21881,
  21924,21966,22009,22052,22094,22137,22179,22222,22265,22307,
  22350,22393,22435,22478,22521,22563,22606,22649,22691,22734,
  22776,22819,22862,22904,22947,22990,23032,23075,23117,23160,
  23203,23245,23288,23331,23373,23416,23458,23501,23544,23586,
  23629,23671,23714,23757,23799,23842,23884,23927,23970,24012,
  24055,24097,24140,24182,24225,24267,24310,24353,24395,24438,
  24480,24523,24565,24608,24650,24693,24735,24778,24820,24863,
  24905,24948,24990,25033,25075,25118,25160,25203,25245,25288,
  25330,25373,25415,25458,25500,25543,25585,25627,25670,25712,
  25755,25797,25840,25882,25924,25967,26009,26052,26094,26136,
  26179,26221,26263,26306,26348,26390,26433,26475,26517,26560,
  26602,26644,26687,26729,26771,26814,26856,26898,26940,26983,
  27025,27067,27109,27152,27194,27236,27278,27320,27363,27405,
  27447,27489,27531,27574,27616,27658,27700,27742,27784,27826,
  27869,27911,27953,27995,28037,28079,28121,28163,28205,28247,
  28289,28332,28374,28416,28458,28500,28542,28584,28626,28668,
  28710,28752,28794,28835,28877,28919,28961,29003,29045,29087,
  29129,29171,29213,29255,29297,29338,29380,29422,29464,29506,
  29548,29589,29631,29673,29715,29757,29798,29840,29882,29924,
  29965,30007,30049,30090,30132,30174,30216,30257,30299,30341,
  30382,30424,30466,30507,30549,30590,30632,30674,30715,30757,
  30798,30840,30881,30923,30964,31006,31047,31089,31130,31172,
  31213,31255,31296,31338,31379,31421,31462,31504,31545,31586,
  31628,31669,31710,31752,31793,31834,31876,31917,31958,32000,
  32041,32082,32124,32165,32206,32247,32289,32330,32371,32412,
  32453,32495,32536,32577,32618,32659,32700,32742,32783,32824,
  32865,32906,32947,32988,33029,33070,33111,33152,33193,33234
};


unsigned short read_temper(void)
{
  unsigned short vlotage;
  unsigned short temp;
  vlotage=AD_slove();
  vlotage=  (unsigned short)(vlotage*7.9768719);//º∆À„µÁ—π÷µ  
  if((Environment_temp<801)&&(Environment_temp>0))
   vlotage=vlotage+temp_AD[Environment_temp];
  
  if(vlotage<33234)
    temp=Get_Temp(vlotage);
  else
    temp=0;
  return temp;
}

unsigned short Get_Temp(unsigned short vlotage)
{
   unsigned short First=0;
   unsigned short End=800;
   unsigned short Difference;
   for(unsigned char i=0;i<11;i++)
   {
      Difference=End-First;
      if(Difference>1)  //
      {
        Difference=Difference/2+First;
        if(vlotage>temp_AD[Difference])
        {
          First=Difference;
        }
        else if(vlotage<temp_AD[Difference])
        {
          End=Difference;
        }
        else
        {
          return Difference;
        }
      }
      else
      {
         if((temp_AD[End]-vlotage)<(vlotage-temp_AD[First]))
           return End;
         else
           return First;
      }
   }
   return 0;
}


#endif